<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è¯´è§†é¢‘å·¥ä½œæµæ§åˆ¶å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#1e40af',
                        dark: '#1f2937',
                        light: '#f9fafb'
                    }
                }
            }
        }
    </script>
    <style>
        /* è§†é¢‘èƒŒæ™¯å®¹å™¨ */
        .video-background {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100;
            overflow: hidden;
        }
        
        /* è§†é¢‘èƒŒæ™¯å®¹å™¨ */
        .video-background {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100;
            overflow: hidden;
        }
        
        /* SVGè’™ç‰ˆå±‚ */
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none" stroke="%23ffffff" stroke-width="0.5" stroke-opacity="0.1"/><circle cx="50" cy="50" r="45" fill="none" stroke="%23ffffff" stroke-opacity="0.05" stroke-width="0.3"/><path d="M20,20 Q40,5 60,20 T100,20" fill="none" stroke="%23ffffff" stroke-opacity="0.05" stroke-width="0.2"/><path d="M10,80 Q30,65 50,80 T90,80" fill="none" stroke="%23ffffff" stroke-opacity="0.05" stroke-width="0.2"/><path d="M70,10 Q85,30 70,50 T70,90" fill="none" stroke="%23ffffff" stroke-opacity="0.05" stroke-width="0.2"/></svg>') repeat;
            z-index: -90;
            pointer-events: none;
        }
        
        /* åˆ›ä½œä¸»é¢˜è£…é¥°å…ƒç´  */
        .creative-element {
            position: absolute;
            z-index: -1;
            opacity: 0.15;
            color: white;
            font-size: 2rem;
            animation: rotate 25s linear infinite;
        }
        
        .creative-element:nth-child(2) {
            top: 20%;
            left: 10%;
            font-size: 3rem;
            animation-delay: -5s;
        }
        
        .creative-element:nth-child(3) {
            top: 60%;
            right: 15%;
            font-size: 2.5rem;
            animation-delay: -10s;
        }
        
        .creative-element:nth-child(4) {
            bottom: 20%;
            left: 20%;
            font-size: 2.8rem;
            animation-delay: -15s;
        }
        
        .creative-element:nth-child(5) {
            top: 40%;
            right: 25%;
            font-size: 2.2rem;
            animation-delay: -18s;
        }
        
        .creative-element:nth-child(6) {
            top: 10%;
            right: 10%;
            font-size: 4rem;
            animation-delay: -8s;
        }
        
        .creative-element:nth-child(7) {
            bottom: 15%;
            right: 20%;
            font-size: 3.5rem;
            animation-delay: -20s;
        }
        
        .creative-element:nth-child(8) {
            top: 30%;
            left: 25%;
            font-size: 3.2rem;
            animation-delay: -12s;
        }
        
        .creative-element:nth-child(9) {
            bottom: 30%;
            right: 30%;
            font-size: 2.7rem;
            animation-delay: -22s;
        }
        
        .creative-element:nth-child(10) {
            top: 70%;
            left: 5%;
            font-size: 2.5rem;
            animation-delay: -25s;
        }
        
        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        /* å½±è§†åˆ›ä½œå¤§å›¾æ ‡ */
        .cinema-icon {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12rem;
            opacity: 0.05;
            z-index: -95;
            pointer-events: none;
            animation: pulse 8s infinite alternate;
        }
        
        @keyframes pulse {
            0% { opacity: 0.03; }
            100% { opacity: 0.07; }
        }
        
        body {
            background: linear-gradient(135deg, #2c3e50 0%, #1c1c1e 100%);
            min-height: 100vh;
            background-attachment: fixed;
            position: relative;
            overflow-x: hidden;
        }
        .glass-effect {
            background: rgba(30, 30, 36, 0.25);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* æå‡æ ‡é¢˜éƒ¨åˆ†çš„å±‚çº§ */
        header {
            position: relative;
            z-index: 10;
        }
        
        /* åŠ¨æ€AIæ¸å˜æ ‡é¢˜ */
        .ai-gradient-text {
            background: linear-gradient(45deg, 
                #FF6B6B, #FF8E53, #FFCE54, #8CC97D, 
                #4BC0C0, #5C9EFF, #AC7AFF, #FF6B9D,
                #6B6BFF, #6BFFD9, #FF6BB3, #B36BFF);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 6s ease-in-out infinite;
        }
        
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            25% { background-position: 50% 100%; }
            50% { background-position: 100% 50%; }
            75% { background-position: 50% 0%; }
            100% { background-position: 0% 50%; }
        }
        .card-hover {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .future-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        .future-glow:hover {
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }
        
        /* è§†é¢‘åˆ›ä½œä¸»é¢˜å¢å¼º */
        .creative-header {
            position: relative;
            overflow: hidden;
        }
        
        .creative-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: -1;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- è§†é¢‘èƒŒæ™¯ -->

    <video id="myVideo" muted autoplay loop class="video-background">
        <source src="assets/m1.mp4" type="video/mp4">
        <source src="assets/m2.mp4" type="video/mp4">
        <source src="assets/m3.mp4" type="video/mp4">
        <source src="assets/m4.mp4" type="video/mp4">
        <source src="assets/m5.mp4" type="video/mp4">
        <source src="assets/m6.mp4" type="video/mp4">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚
        <!-- æ·»åŠ è§†é¢‘æº -->
    </video>

    <script>
        var video = document.getElementById("myVideo");
        var videos = ["assets/m1.mp4", "assets/m2.mp4", "assets/m3.mp4", "assets/m4.mp4", "assets/m5.mp4","assets/m6.mp4"];
        var currentIndex = Math.floor(Math.random() * videos.length); // éšæœºé€‰æ‹©èµ·å§‹è§†é¢‘

        // éšæœºæ’­æ”¾ä¸‹ä¸€ä¸ªè§†é¢‘
        video.addEventListener("ended", function() {
            var previousIndex = currentIndex;
            // éšæœºé€‰æ‹©ä¸‹ä¸€ä¸ªè§†é¢‘ï¼Œç¡®ä¿ä¸é‡å¤æ’­æ”¾åŒä¸€ä¸ªè§†é¢‘
            do {
                currentIndex = Math.floor(Math.random() * videos.length);
            } while (videos.length > 1 && currentIndex === previousIndex);
            
            video.src = videos[currentIndex];
            video.load(); // é‡æ–°åŠ è½½æ–°è§†é¢‘æº
            video.play();
        });

        // åˆå§‹åŒ–éšæœºæ’­æ”¾ç¬¬ä¸€ä¸ªè§†é¢‘
        video.src = videos[currentIndex];
        video.play();
    </script>
    <!-- SVGè’™ç‰ˆå±‚ -->
    <div class="background-overlay"></div>
    
    <!-- å½±è§†åˆ›ä½œå¤§å›¾æ ‡ -->
    <div class="cinema-icon">ğŸ¦</div>
    
    <!-- åˆ›ä½œä¸»é¢˜è£…é¥°å…ƒç´  -->
    <div class="creative-element">
        <i class="fas fa-film"></i>
    </div>
    <div class="creative-element">
        <i class="fas fa-video"></i>
    </div>
    <div class="creative-element">
        <i class="fas fa-camera"></i>
    </div>
    <div class="creative-element">
        <i class="fas fa-edit"></i>
    </div>
    <div class="creative-element">
        <i class="fas fa-lightbulb"></i>
    </div>
    <div class="creative-element">
        <i class="fas fa-music"></i>
    </div>
    <div class="creative-element">
        <i class="fas fa-star"></i>
    </div>
    
    <!-- Full-width Header with glass effect -->
    <header class="w-full mb-6 text-center relative z-20 glass-effect rounded-none p-6 mx-0">
        <h1 class="text-4xl md:text-5xl font-bold mb-2 flex items-center justify-center">
            <i class="fas fa-clapperboard mr-2 text-6xl md:text-6xl ai-gradient-text"></i>
            <span class="ai-gradient-text">å°è¯´è§†é¢‘å·¥ä½œæµ</span>
        </h1>
        <p class="text-2xl text-indigo-200 mb-1">AIé©±åŠ¨çš„æ™ºèƒ½å†…å®¹ç”Ÿæˆç³»ç»Ÿ</p>
        <p class="text-xl text-purple-200">ä¸€é”®å°†æ–‡å­—è½¬åŒ–ä¸ºå¤šåª’ä½“å†…å®¹ï¼Œé‡Šæ”¾åˆ›ä½œæ— é™å¯èƒ½</p>
    </header>

    <div class="container mx-auto px-3 py-4 max-w-6xl relative z-10">
        <!-- Navigation Tabs - Centered layout -->
        <div class="mb-8 glass-effect rounded-2xl overflow-hidden relative z-20">
            <div class="flex flex-wrap justify-center border-b border-white border-opacity-30">
                <button class="nav-tab active px-8 py-4 font-semibold text-sm md:text-base text-white bg-white bg-opacity-30 hover:bg-white hover:bg-opacity-40 transition-colors future-glow" onclick="switchTab('dashboard')">
                    <i class="fas fa-film mr-2 text-lg"></i>ä»ªè¡¨æ¿
                </button>
                <button class="nav-tab px-8 py-4 font-semibold text-sm md:text-base text-gray-200 bg-transparent hover:bg-white hover:bg-opacity-30 transition-colors" onclick="switchTab('tools')">
                    <i class="fas fa-cogs mr-2 text-lg"></i>MCP å·¥å…·
                </button>
                <button class="nav-tab px-8 py-4 font-semibold text-sm md:text-base text-gray-200 bg-transparent hover:bg-white hover:bg-opacity-30 transition-colors" onclick="switchTab('upload')">
                    <i class="fas fa-file-upload mr-2 text-lg"></i>ä¸Šä¼ å¹¶å¤„ç†
                </button>
                <button class="nav-tab px-8 py-4 font-semibold text-sm md:text-base text-gray-200 bg-transparent hover:bg-white hover:bg-opacity-30 transition-colors" onclick="switchTab('filemanager')">
                    <i class="fas fa-folder mr-2 text-lg"></i>æ–‡ä»¶ç®¡ç†
                </button>
                <button class="nav-tab px-8 py-4 font-semibold text-sm md:text-base text-gray-200 bg-transparent hover:bg-white hover:bg-opacity-30 transition-colors" onclick="switchTab('tutorial')">
                    <i class="fas fa-graduation-cap mr-2 text-lg"></i>æ•™ç¨‹
                </button>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active glass-effect rounded-xl p-6 mb-4 card-hover relative z-20">
            <h2 class="text-xl font-semibold mb-4 text-white flex items-center">
                <i class="fas fa-film mr-2 text-blue-300 text-xl"></i>å·¥ä½œæµä»ªè¡¨æ¿
            </h2>
            <div class="mb-4">
                <p class="mb-3 text-base text-gray-200">å½“å‰çŠ¶æ€: <span id="current-status" class="font-bold text-green-400">ç©ºé—²</span></p>
                <div class="flex flex-wrap gap-4">
                    <button onclick="oneClickFilm()" class="bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 px-6 py-3 rounded-lg transition-all duration-200 flex items-center shadow-lg hover:shadow-xl future-glow text-base">
                        <i class="fas fa-film mr-2 text-base"></i>ä¸€é”®å‡ºç‰‡
                    </button>
                    <button onclick="stopExecution()" class="bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 px-6 py-3 rounded-lg transition-all duration-200 flex items-center shadow-lg hover:shadow-xl future-glow text-base">
                        <i class="fas fa-stop-circle mr-2 text-base"></i>åœæ­¢æ‰§è¡Œ
                    </button>
                </div>
            </div>
        </div>

        <!-- Tools Tab -->
        <div id="tools" class="tab-content glass-effect rounded-xl p-6 mb-4 hidden card-hover relative z-20">
            <h2 class="text-xl font-semibold mb-4 text-white flex items-center">
                <i class="fas fa-cogs mr-2 text-blue-300 text-xl"></i>MCP å·¥å…·
            </h2>
            <div id="tools-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>

        <!-- Upload Tab -->
        <div id="upload" class="tab-content glass-effect rounded-2xl p-8 mb-6 hidden card-hover relative z-20">
            <h2 class="text-2xl font-bold mb-6 text-white flex items-center">
                <i class="fas fa-file-upload mr-3 text-blue-300 text-2xl"></i>ä¸Šä¼ æ–‡ä»¶å¤¹å¹¶å¤„ç†
            </h2>
            <div class="upload-area border-2 border-dashed border-gray-400 rounded-xl p-12 text-center mb-6 glass-effect hover:border-gray-300 transition-all duration-200 cursor-pointer future-glow" id="folderUploadArea">
                <i class="fas fa-cloud-upload text-4xl text-gray-400 mb-4"></i>
                <p class="text-lg text-white mb-2 font-medium">æ‹–æ”¾æ–‡ä»¶å¤¹åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©</p>
                <p class="text-base text-gray-300">æ”¯æŒæ–‡ä»¶å¤¹ä¸Šä¼ ï¼Œæ ‡å‡†æ ¼å¼ä¸º'å°è¯´å/å°è¯´å.txt'</p>
                <p class="text-sm text-yellow-200 mt-2">æ³¨æ„ï¼šæµè§ˆå™¨ä¼šæ˜¾ç¤ºå®‰å…¨æç¤ºï¼Œä»…åœ¨ä¿¡ä»»æœ¬ç«™ç‚¹æ—¶ä¸Šä¼ </p>
                <input type="file" id="folderInput" webkitdirectory directory multiple class="hidden" onchange="handleFolderUpload(this.files)" />
            </div>
            <div class="flex flex-wrap gap-4">
                <button onclick="document.getElementById('folderInput').click()" class="bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 px-6 py-3 rounded-lg transition-all duration-200 flex items-center shadow-lg hover:shadow-xl future-glow text-base">
                    <i class="fas fa-folder-open mr-2 text-base"></i>é€‰æ‹©æ–‡ä»¶å¤¹
                </button>
                <button onclick="processFolder()" class="bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 px-6 py-3 rounded-lg transition-all duration-200 flex items-center shadow-lg hover:shadow-xl future-glow text-base">
                    <i class="fas fa-cogs mr-2 text-base"></i>å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶å¤¹
                </button>
            </div>
            <p id="uploadStatus" class="mt-6 text-xl text-gray-200"></p>
        </div>

        <!-- File Manager Tab -->
        <div id="filemanager" class="tab-content glass-effect rounded-xl p-6 mb-4 hidden card-hover relative z-20">
            <h2 class="text-xl font-semibold mb-4 text-white flex items-center">
                <i class="fas fa-folder mr-2 text-blue-300 text-xl"></i>æ–‡ä»¶ç®¡ç†
            </h2>
            <div class="file-manager-container">
                <div class="file-nav mb-4 flex flex-wrap gap-3 justify-center">
                    <button onclick="changeDirectory('./input')" class="btn-dir bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 px-5 py-2 rounded-md transition-all duration-200 flex items-center shadow-md hover:shadow-lg future-glow text-sm">
                        <i class="fas fa-folder mr-2 text-sm"></i>è¾“å…¥ç›®å½• (./input)
                    </button>
                    <button onclick="changeDirectory('./output')" class="btn-dir bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 px-5 py-2 rounded-md transition-all duration-200 flex items-center shadow-md hover:shadow-lg future-glow text-sm">
                        <i class="fas fa-folder mr-2 text-sm"></i>è¾“å‡ºç›®å½• (./output)
                    </button>
                </div>
                <div class="file-actions mb-4 text-center">
                    <div class="upload-section inline-block">
                        <input type="file" id="fileUpload" onchange="handleFileUpload(this.files)" class="hidden" />
                        <button onclick="document.getElementById('fileUpload').click()" class="bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 px-5 py-2 rounded-md transition-all duration-200 flex items-center shadow-md hover:shadow-lg future-glow text-sm">
                            <i class="fas fa-upload mr-2 text-sm"></i>ä¸Šä¼ æ–‡ä»¶
                        </button>
                    </div>
                </div>
                <div id="fileList" class="file-list glass-effect rounded-xl p-4"></div>
            </div>
        </div>

        <!-- Tutorial Tab -->
        <div id="tutorial" class="tab-content glass-effect rounded-xl p-6 mb-4 hidden card-hover relative z-20">
            <h2 class="text-xl font-semibold mb-4 text-white flex items-center">
                <i class="fas fa-graduation-cap mr-2 text-blue-300 text-xl"></i>æ•™ç¨‹
            </h2>
            <div class="tutorial space-y-6">
                <div class="tutorial-section glass-effect rounded-xl p-6">
                    <h3 class="text-lg font-medium text-white flex items-center">
                        <i class="fas fa-info-circle mr-2 text-blue-300 text-base"></i>å…¥é—¨æŒ‡å—
                    </h3>
                    <ul class="list-disc pl-6 mt-3 space-y-2 text-base text-gray-200">
                        <li>æ­¤æ§åˆ¶å°å…è®¸æ‚¨ç®¡ç†å’Œæ‰§è¡Œ MCP æœåŠ¡</li>
                        <li>ä½¿ç”¨ MCP å·¥å…·æ ‡ç­¾é¡µæŸ¥çœ‹å’Œæ‰§è¡Œå•ä¸ªå·¥å…·</li>
                        <li>ä½¿ç”¨ä¸Šä¼ å¹¶å¤„ç†æ ‡ç­¾é¡µä¸Šä¼ æ–‡ä»¶å¤¹å¹¶è¿è¡Œæ•´ä¸ªå·¥ä½œæµ</li>
                        <li>ä½¿ç”¨æ–‡ä»¶ç®¡ç†æ ‡ç­¾é¡µç®¡ç†inputå’Œoutputç›®å½•ä¸­çš„æ–‡ä»¶</li>
                        <li>åœ¨æ¯ä¸ªéƒ¨åˆ†åº•éƒ¨çš„æ§åˆ¶å°ä¸­ç›‘è§†è¿›åº¦</li>
                    </ul>
                </div>
                
                <div class="tutorial-section glass-effect rounded-xl p-6">
                    <h3 class="text-lg font-medium text-white flex items-center">
                        <i class="fas fa-cogs mr-2 text-blue-300 text-base"></i>æ‰§è¡Œå•ä¸ªå·¥å…·
                    </h3>
                    <ul class="list-disc pl-6 mt-3 space-y-2 text-base text-gray-200">
                        <li>å¯¼èˆªåˆ° MCP å·¥å…·æ ‡ç­¾é¡µ</li>
                        <li>æ‚¨å°†çœ‹åˆ°æ‰€æœ‰å¯ç”¨ MCP å·¥å…·çš„åˆ—è¡¨</li>
                        <li>ç‚¹å‡»ä»»ä½•å·¥å…·ä¸Šçš„"æ‰§è¡Œ"æŒ‰é’®å•ç‹¬è¿è¡Œå®ƒ</li>
                        <li>åœ¨æ§åˆ¶å°ä¸­ç›‘è§†æ‰§è¡Œæ—¥å¿—</li>
                    </ul>
                </div>
                
                <div class="tutorial-section glass-effect rounded-xl p-6">
                    <h3 class="text-lg font-medium text-white flex items-center">
                        <i class="fas fa-file-upload mr-2 text-blue-300 text-base"></i>å¤„ç†æ•´ä¸ªæ–‡ä»¶å¤¹
                    </h3>
                    <ul class="list-disc pl-6 mt-3 space-y-2 text-base text-gray-200">
                        <li>è½¬åˆ°ä¸Šä¼ å¹¶å¤„ç†æ ‡ç­¾é¡µ</li>
                        <li>æ‹–æ”¾æ–‡ä»¶å¤¹æˆ–ç‚¹å‡»é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶å¤¹</li>
                        <li>ç‚¹å‡»"å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶å¤¹"å¼€å§‹å·¥ä½œæµ</li>
                        <li>åœ¨æ§åˆ¶å°ä¸­ç›‘è§†è¿›åº¦</li>
                    </ul>
                </div>
                
                <div class="tutorial-section glass-effect rounded-xl p-6">
                    <h3 class="text-lg font-medium text-white flex items-center">
                        <i class="fas fa-folder mr-2 text-purple-300 text-base"></i>æ–‡ä»¶ç®¡ç†
                    </h3>
                    <ul class="list-disc pl-6 mt-3 space-y-2 text-base text-gray-200">
                        <li>è½¬åˆ°æ–‡ä»¶ç®¡ç†æ ‡ç­¾é¡µ</li>
                        <li>ä½¿ç”¨é¡¶éƒ¨æŒ‰é’®åˆ‡æ¢åˆ°è¾“å…¥(input)æˆ–è¾“å‡º(output)ç›®å½•</li>
                        <li>ç‚¹å‡»æ–‡ä»¶åå¯é¢„è§ˆæ–‡æœ¬æ–‡ä»¶å†…å®¹</li>
                        <li>ç‚¹å‡»åˆ é™¤æŒ‰é’®å¯åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•</li>
                        <li>ä½¿ç”¨ä¸Šä¼ æŒ‰é’®å¯ä¸Šä¼ æ–°æ–‡ä»¶</li>
                    </ul>
                </div>
                
                <div class="tutorial-section glass-effect rounded-xl p-6">
                    <h3 class="text-lg font-medium text-white flex-items-center">
                        <i class="fas fa-chart-bar mr-2 text-red-300 text-base"></i>ç›‘æ§è¿›åº¦
                    </h3>
                    <ul class="list-disc pl-6 mt-3 space-y-2 text-base text-gray-200">
                        <li>æ§åˆ¶å°æ˜¾ç¤ºæ¥è‡ª MCP å·¥å…·çš„å®æ—¶æ—¥å¿—</li>
                        <li>ç»¿è‰²æ–‡æœ¬è¡¨ç¤ºä¿¡æ¯æ¶ˆæ¯</li>
                        <li>äº®ç»¿è‰²æ–‡æœ¬è¡¨ç¤ºæˆåŠŸæ¶ˆæ¯</li>
                        <li>çº¢è‰²æ–‡æœ¬è¡¨ç¤ºé”™è¯¯æ¶ˆæ¯</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Console -->
        <div class="console-container glass-effect text-blue-300 font-mono rounded-2xl p-8 mb-6 relative z-20">
            <h3 class="text-xl font-bold mb-4 text-white flex items-center">
                <i class="fas fa-terminal mr-2 text-blue-300 text-lg"></i>å®æ—¶æ—¥å¿—æ§åˆ¶å°
            </h3>
            <div id="console" class="console h-72 overflow-y-auto p-5 glass-effect rounded-xl text-sm"></div>
        </div>
        
        <!-- Footer with copyright -->
        <footer class="mt-12 text-center relative z-20">
            <p class="text-sm text-white">Â© 2026 å°è¯´è§†é¢‘å·¥ä½œæµç³»ç»Ÿ. ç‰ˆæƒæ‰€æœ‰.</p>
            <p class="text-xs text-gray-500 mt-1"></p>
        </footer>
    </div>

    <script>
        // WebSocketè¿æ¥
        const socket = new WebSocket('ws://' + window.location.host + '/ws');
        
        socket.onopen = function(event) {
            console.log('Connected to WebSocket');
        };
        
        socket.onmessage = function(event) {
            const logData = JSON.parse(event.data);
            const consoleDiv = document.getElementById('console');
            
            const timestamp = new Date().toLocaleTimeString();
            const lineDiv = document.createElement('div');
            lineDiv.className = 'console-line ' + logData.type;
            lineDiv.innerHTML = '<span class="text-gray-400">[' + timestamp + ']</span> ' +
                               '<span class="text-blue-300">[' + logData.toolName + ']</span> ' +
                               '<span class="' + (logData.type === 'error' ? 'text-red-400' : 
                                  logData.type === 'success' ? 'text-green-400 font-bold' : 
                                  'text-gray-300') + '">' + logData.message + '</span>';
            
            consoleDiv.appendChild(lineDiv);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        // æ–‡ä»¶ç®¡ç†ç›¸å…³å‡½æ•°
        let currentDirectory = 'input'; // é»˜è®¤ç›®å½•
        
        // åˆ‡æ¢ç›®å½•
        function changeDirectory(dir) {
            // å»æ‰ ./ å‰ç¼€ï¼Œåªä¿ç•™ç›®å½•å
            currentDirectory = dir.startsWith('./') ? dir.substring(2) : dir;
            loadFileList(currentDirectory);
        }
        
        // åŠ è½½æ–‡ä»¶åˆ—è¡¨
        function loadFileList(dir) {
            // æ„å»ºæ­£ç¡®çš„è·¯å¾„æ ¼å¼ï¼Œç¡®ä¿åç«¯èƒ½æ­£ç¡®å¤„ç†
            var pathToUse = dir;
            // å¦‚æœè·¯å¾„ä¸ä»¥ ./ å¼€å¤´ï¼Œæ·»åŠ å‰ç¼€
            if (!dir.startsWith('./')) {
                pathToUse = './' + dir;
            }
            
            fetch('/api/files/list?dir=' + encodeURIComponent(pathToUse))
                .then(response => response.json())
                .then(data => {
                    const fileListDiv = document.getElementById('fileList');
                    fileListDiv.innerHTML = '';
                    
                    if (data.files.length === 0) {
                        fileListDiv.innerHTML = '<div class="text-center py-16 text-2xl text-gray-300"><i class="fas fa-inbox text-6xl mb-6 opacity-50"></i><p>ç›®å½•ä¸ºç©º</p></div>';
                        return;
                    }
                    
                    // åˆ›å»ºæ–‡ä»¶è¡¨æ ¼
                    const table = document.createElement('table');
                    table.className = 'min-w-full divide-y divide-gray-600';
                    table.innerHTML = `
                        <thead class="bg-black bg-opacity-20">
                            <tr>
                                <th class="px-6 py-5 text-left text-lg font-bold text-gray-300 uppercase tracking-wider rounded-tl-lg">åç§°</th>
                                <th class="px-6 py-5 text-left text-lg font-bold text-gray-300 uppercase tracking-wider">ç±»å‹</th>
                                <th class="px-6 py-5 text-left text-lg font-bold text-gray-300 uppercase tracking-wider">å¤§å°</th>
                                <th class="px-6 py-5 text-left text-lg font-bold text-gray-300 uppercase tracking-wider">ä¿®æ”¹æ—¶é—´</th>
                                <th class="px-6 py-5 text-left text-lg font-bold text-gray-300 uppercase tracking-wider rounded-tr-lg">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-600"></tbody>
                    `;
                    
                    const tbody = table.querySelector('tbody');
                    
                    data.files.forEach(function(file) {
                        const row = document.createElement('tr');
                        row.className = 'hover:bg-white hover:bg-opacity-10 transition-colors duration-150';
                        
                        var fileTypeDisplay = file.isDir ? 'ğŸ“' : getFileIconByType(file.type);
                        var fileSizeDisplay = file.isDir ? '-' : formatFileSize(file.size);
                        var previewButton = '';
                        // æ‰©å±•é¢„è§ˆåŠŸèƒ½åˆ°å›¾ç‰‡å’ŒéŸ³é¢‘æ–‡ä»¶
                        if (!file.isDir && ['text', 'json', 'yaml', 'yml', 'xml', 'csv', 'log', 'md', 'image', 'audio'].includes(file.type)) {
                            previewButton = '<button onclick="previewFile(\'' + file.name + '\')" class="text-blue-300 hover:text-blue-100 mr-5 text-lg transition-colors duration-150"><i class="fas fa-eye mr-2"></i>é¢„è§ˆ</button>';
                        }
                        var modTime = new Date(file.modTime).toLocaleString();
                        
                        row.innerHTML = `
                            <td class="px-6 py-6 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="mr-5 text-2xl opacity-80">${fileTypeDisplay}</div>
                                    <div class="text-xl font-medium text-gray-200">
                                        <span onclick="clickFileOrDir('${file.name}', ${file.isDir})" class="cursor-pointer hover:text-blue-300 transition-colors duration-150">${file.name}</span>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-6 whitespace-nowrap text-xl text-gray-300">${file.type}</td>
                            <td class="px-6 py-6 whitespace-nowrap text-xl text-gray-300">${fileSizeDisplay}</td>
                            <td class="px-6 py-6 whitespace-nowrap text-xl text-gray-300">${modTime}</td>
                            <td class="px-6 py-6 whitespace-nowrap text-xl font-medium">
                                ${previewButton}
                                ${file.isDir && file.name.match(/^chapter_\d+$/) && (currentDirectory.includes('/output/') || currentDirectory.includes('output')) ? '<button onclick="sendToCapcut(\'' + file.name + '\')" class="text-green-400 hover:text-green-200 mr-5 text-lg transition-colors duration-150"><i class="fas fa-share mr-2"></i>ä¸€é”®åˆ°å‰ªæ˜ </button>' : ''}
                                <button onclick="deleteFile('${file.name}', ${file.isDir})" class="text-red-400 hover:text-red-200 transition-colors duration-150"><i class="fas fa-trash mr-2"></i>åˆ é™¤</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    fileListDiv.appendChild(table);
                })
                .catch(function(error) {
                    console.error('Error loading file list:', error);
                    const fileListDiv = document.getElementById('fileList');
                    fileListDiv.innerHTML = '<div class="text-red-400 p-8 text-center text-xl"><i class="fas fa-exclamation-triangle mr-3"></i>åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥: ' + error.message + '</div>';
                });
        }
        
        // æ ¹æ®æ–‡ä»¶ç±»å‹è·å–å›¾æ ‡
        function getFileIconByType(fileType) {
            switch(fileType) {
                case 'image':
                    return 'ğŸ–¼ï¸';
                case 'video':
                    return 'ğŸ¬';
                case 'audio':
                    return 'ğŸµ';
                case 'pdf':
                    return 'ğŸ“„';
                case 'archive':
                    return 'ğŸ“¦';
                case 'text':
                case 'json':
                case 'yaml':
                case 'yml':
                case 'xml':
                case 'csv':
                case 'log':
                case 'md':
                    return 'ğŸ“';
                default:
                    return 'ğŸ“„';
            }
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // ç‚¹å‡»æ–‡ä»¶æˆ–ç›®å½•
        function clickFileOrDir(name, isDir) {
            if (isDir) {
                // è¿›å…¥å­ç›®å½•
                var newPath = currentDirectory;
                if (newPath.endsWith('/')) {
                    newPath += name;
                } else {
                    newPath += '/' + name;
                }
                changeDirectory('./' + newPath);
            } else {
                // å¯¹äºæ”¯æŒé¢„è§ˆçš„æ–‡ä»¶ç±»å‹ï¼Œæ‰“å¼€é¢„è§ˆ
                previewFile(name);
            }
        }
        
        // é¢„è§ˆæ–‡ä»¶
        function previewFile(filename) {
            const fullPath = './' + currentDirectory + '/' + filename;
            
            // æ ¹æ®æ–‡ä»¶æ‰©å±•ååˆ¤æ–­æ–‡ä»¶ç±»å‹
            const ext = filename.split('.').pop().toLowerCase();
            const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'];
            const audioExtensions = ['mp3', 'wav', 'ogg', 'm4a', 'flac'];
            const textExtensions = ['txt', 'json', 'yaml', 'yml', 'xml', 'csv', 'log', 'md'];
            const subtitleExtensions = ['srt', 'ass', 'vtt']; // å­—å¹•æ–‡ä»¶
            
            if(imageExtensions.includes(ext)) {
                // å›¾ç‰‡é¢„è§ˆ - ä½¿ç”¨æ­£ç¡®çš„é™æ€æ–‡ä»¶è·¯å¾„
                const staticPath = convertToStaticPath(fullPath);
                showImagePreview(staticPath, filename);
            } else if(audioExtensions.includes(ext)) {
                // éŸ³é¢‘é¢„è§ˆ - ä½¿ç”¨æ­£ç¡®çš„é™æ€æ–‡ä»¶è·¯å¾„
                const staticPath = convertToStaticPath(fullPath);
                showAudioPreview(staticPath, filename);
            } else if(subtitleExtensions.includes(ext)) {
                // å­—å¹•æ–‡ä»¶é¢„è§ˆï¼ˆé€šè¿‡APIè·å–å†…å®¹ï¼‰
                fetch('/api/files/content?path=' + encodeURIComponent(fullPath))
                    .then(response => response.text())
                    .then(content => {
                        showTextPreview(content, filename);
                    })
                    .catch(function(error) {
                        console.error('Error previewing subtitle file:', error);
                        alert('æ— æ³•é¢„è§ˆå­—å¹•æ–‡ä»¶: ' + error.message);
                    });
            } else if(textExtensions.includes(ext)) {
                // æ–‡æœ¬æ–‡ä»¶é¢„è§ˆï¼ˆé€šè¿‡APIè·å–å†…å®¹ï¼‰
                fetch('/api/files/content?path=' + encodeURIComponent(fullPath))
                    .then(response => response.text())
                    .then(content => {
                        showTextPreview(content, filename);
                    })
                    .catch(function(error) {
                        console.error('Error previewing text file:', error);
                        alert('æ— æ³•é¢„è§ˆæ–‡ä»¶: ' + error.message);
                    });
            } else {
                // å¯¹äºå…¶ä»–æ–‡ä»¶ç±»å‹ï¼Œå°è¯•é€šè¿‡APIè·å–å†…å®¹
                fetch('/api/files/content?path=' + encodeURIComponent(fullPath))
                    .then(response => {
                        if (response.ok) {
                            // å¦‚æœæ˜¯æ–‡æœ¬å†…å®¹åˆ™æ˜¾ç¤ºä¸ºæ–‡æœ¬ï¼Œå¦åˆ™æç¤ºæ— æ³•é¢„è§ˆ
                            return response.text().then(content => {
                                showTextPreview(content, filename);
                            });
                        } else {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    })
                    .catch(function(error) {
                        console.error('Error previewing file:', error);
                        alert('æ— æ³•é¢„è§ˆæ–‡ä»¶: ' + error.message);
                    });
            }
        }
        
        // å°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºé™æ€æ–‡ä»¶æœåŠ¡è·¯å¾„
        function convertToStaticPath(relativePath) {
            // å°† ./input/path æˆ– ./output/path è½¬æ¢ä¸º /files/input/path æˆ– /files/output/path
            if (relativePath.startsWith('./input/')) {
                return '/files/input/' + relativePath.substring(9); // 9 = length of './input/'
            } else if (relativePath.startsWith('./output/')) {
                return '/files/output/' + relativePath.substring(9); // 9 = length of './output/'
            }
            return relativePath; // å¦‚æœä¸æ˜¯æ ‡å‡†è·¯å¾„ï¼Œè¿”å›åŸå§‹è·¯å¾„
        }
        
        // æ˜¾ç¤ºæ–‡æœ¬é¢„è§ˆ
        function showTextPreview(content, filename) {
            // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            overlay.id = 'modalOverlay';
            
            const modal = document.createElement('div');
            modal.className = 'glass-effect rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col border border-white border-opacity-30';
            
            const header = document.createElement('div');
            header.className = 'flex justify-between items-center p-6 border-b border-white border-opacity-30 rounded-t-2xl';
            header.innerHTML = `
                <h3 class="text-xl font-bold text-white">é¢„è§ˆ: ${filename}</h3>
                <button onclick="closeModal()" class="text-gray-300 hover:text-white text-3xl leading-none">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'p-6 flex-grow overflow-auto';
            contentDiv.innerHTML = '<pre class="whitespace-pre-wrap break-words font-mono text-lg text-gray-200 bg-black bg-opacity-30 p-6 rounded-xl">' + escapeHtml(content) + '</pre>';
            
            modal.appendChild(header);
            modal.appendChild(contentDiv);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
        }
        
        // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
        function showImagePreview(filePath, filename) {
            // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºå›¾ç‰‡
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4';
            overlay.id = 'modalOverlay';
            
            const modal = document.createElement('div');
            modal.className = 'w-full max-w-6xl max-h-[90vh] flex flex-col';
            
            const header = document.createElement('div');
            header.className = 'flex justify-between items-center p-4 bg-black bg-opacity-30 rounded-t-2xl';
            header.innerHTML = `
                <h3 class="text-xl font-bold text-white">é¢„è§ˆ: ${filename}</h3>
                <button onclick="closeModal()" class="text-gray-300 hover:text-white text-3xl leading-none">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'flex-grow flex items-center justify-center p-4';
            contentDiv.innerHTML = `<img src="${filePath}" alt="${filename}" class="max-h-[70vh] max-w-full object-contain rounded-xl">`;
            
            modal.appendChild(header);
            modal.appendChild(contentDiv);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
        }
        
        // æ˜¾ç¤ºéŸ³é¢‘é¢„è§ˆ
        function showAudioPreview(filePath, filename) {
            // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºéŸ³é¢‘æ’­æ”¾å™¨
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            overlay.id = 'modalOverlay';
            
            const modal = document.createElement('div');
            modal.className = 'glass-effect rounded-2xl w-full max-w-2xl flex flex-col border border-white border-opacity-30';
            
            const header = document.createElement('div');
            header.className = 'flex justify-between items-center p-6 border-b border-white border-opacity-30 rounded-t-2xl';
            header.innerHTML = `
                <h3 class="text-xl font-bold text-white">æ’­æ”¾: ${filename}</h3>
                <button onclick="closeModal()" class="text-gray-300 hover:text-white text-3xl leading-none">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'p-8 flex flex-col items-center';
            contentDiv.innerHTML = `
                <div class="w-full max-w-md">
                    <div class="text-center mb-6">
                        <i class="fas fa-music text-6xl text-blue-400 mb-4"></i>
                        <p class="text-xl text-white">${filename}</p>
                    </div>
                    <audio controls class="w-full h-12 rounded-lg">
                        <source src="${filePath}" type="audio/${filename.split('.').pop()}">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
                    </audio>
                </div>
            `;
            
            modal.appendChild(header);
            modal.appendChild(contentDiv);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
        }
        
        // è½¬ä¹‰HTMLä»¥é˜²æ­¢XSS
        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            const overlay = document.getElementById('modalOverlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•
        function deleteFile(filename, isDir) {
            var confirmMessage = 'ç¡®å®šè¦åˆ é™¤' + (isDir ? 'ç›®å½•' : 'æ–‡ä»¶') + ' "' + filename + '" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚';
            if (confirm(confirmMessage)) {
                const fullPath = './' + currentDirectory + '/' + filename;
                fetch('/api/files/delete?path=' + encodeURIComponent(fullPath), {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert((isDir ? 'ç›®å½•' : 'æ–‡ä»¶') + ' å·²æˆåŠŸåˆ é™¤');
                        loadFileList(currentDirectory); // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
                    } else {
                        alert('åˆ é™¤å¤±è´¥: ' + data.message);
                    }
                })
                .catch(function(error) {
                    console.error('Error deleting file:', error);
                    alert('åˆ é™¤å¤±è´¥: ' + error.message);
                });
            }
        }
        
        // å‘é€åˆ°å‰ªæ˜ åŠŸèƒ½
        function sendToCapcut(folderName) {
            if (!folderName.match(/^chapter_\d+$/)) {
                alert('è¯·é€‰æ‹©æ­£ç¡®çš„ç« èŠ‚ç›®å½•ï¼ˆæ ¼å¼ä¸ºchapter_XXï¼‰');
                return;
            }
            
            // æ„å»ºå®Œæ•´çš„è·¯å¾„
            const fullPath = './' + currentDirectory + '/' + folderName;
            
            if (confirm('ç¡®å®šè¦å°† ' + folderName + ' å¯¼å…¥åˆ°å‰ªæ˜ å—ï¼Ÿ')) {
                fetch('/api/capcut-project?chapter_path=' + encodeURIComponent(fullPath))
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            alert('å·²å¼€å§‹ç”Ÿæˆå‰ªæ˜ é¡¹ç›®ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¿›åº¦');
                        } else {
                            alert('æ“ä½œå¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('æ“ä½œå¤±è´¥: ' + error.message);
                    });
            }
        }
        
        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(files) {
            if (files.length === 0) return;
            
            // å¤„ç†å¤šä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä¿æŒç›®å½•ç»“æ„
            uploadMultipleFiles(Array.from(files), './' + currentDirectory);
        }
        
        function handleFolderUpload(files) {
            if (files.length === 0) return;
            
            // ä¸Šä¼ æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¿æŒç›®å½•ç»“æ„
            uploadMultipleFiles(Array.from(files), './input');
        }
        
        function uploadMultipleFiles(files, baseDir) {
            if (files.length === 0) return;
            
            // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
            document.getElementById('uploadStatus').innerHTML = `å¼€å§‹ä¸Šä¼  ${files.length} ä¸ªæ–‡ä»¶...`;
            
            // é€’å½’ä¸Šä¼ æ–‡ä»¶æ•°ç»„ä¸­çš„æ¯ä¸ªæ–‡ä»¶
            const uploadNext = (index) => {
                if (index >= files.length) {
                    // æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆååˆ·æ–°æ–‡ä»¶åˆ—è¡¨
                    loadFileList(currentDirectory);
                    document.getElementById('uploadStatus').innerHTML = `æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆ (${files.length} ä¸ªæ–‡ä»¶)`;
                    return;
                }
                
                const file = files[index];
                
                // åˆ›å»ºFormDataå¯¹è±¡
                const formData = new FormData();
                formData.append('file', file);
                
                // å¤„ç†æ–‡ä»¶è·¯å¾„ï¼Œä¿æŒç›®å½•ç»“æ„
                let filePath = file.webkitRelativePath || file.name;
                if (filePath.startsWith('./')) {
                    filePath = filePath.substring(2);
                }
                
                // è®¡ç®—å®Œæ•´çš„ç›®æ ‡è·¯å¾„
                let fullDestPath = baseDir;
                if (fullDestPath.endsWith('/')) {
                    fullDestPath += filePath;
                } else {
                    fullDestPath += '/' + filePath;
                }
                
                // è·å–ç›®å½•éƒ¨åˆ†ï¼Œç”¨äºåˆ›å»ºç›®å½•
                let destDir = fullDestPath.substring(0, fullDestPath.lastIndexOf('/'));
                if (destDir === '') {
                    destDir = baseDir;
                }
                
                formData.append('dir', destDir);
                
                // æ˜¾ç¤ºä¸Šä¼ çŠ¶æ€
                document.getElementById('uploadStatus').innerHTML = `ä¸Šä¼ ä¸­: ${filePath} (${index + 1}/${files.length})`;
                
                fetch('/api/files/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        console.log('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: ' + data.filename);
                    } else {
                        console.error('ä¸Šä¼ å¤±è´¥: ' + data.message);
                    }
                    
                    // ç»§ç»­ä¸Šä¼ ä¸‹ä¸€ä¸ªæ–‡ä»¶
                    uploadNext(index + 1);
                })
                .catch(function(error) {
                    console.error('Error uploading file:', error);
                    document.getElementById('uploadStatus').innerHTML = `ä¸Šä¼ å¤±è´¥: ${error.message}`;
                    
                    // å³ä½¿å‡ºé”™ä¹Ÿç»§ç»­ä¸Šä¼ ä¸‹ä¸€ä¸ªæ–‡ä»¶
                    uploadNext(index + 1);
                });
            };
            
            uploadNext(0);
        }
        
        // æ·»åŠ æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
        function initDragAndDrop() {
            const dropArea = document.getElementById('folderUploadArea');
            
            if (dropArea) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, preventDefaults, false);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropArea.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, unhighlight, false);
                });
                
                function highlight() {
                    dropArea.style.borderColor = '#3b82f6';
                    dropArea.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';
                }
                
                function unhighlight() {
                    dropArea.style.borderColor = '#9ca3af';
                    dropArea.style.backgroundColor = 'transparent';
                }
                
                dropArea.addEventListener('drop', handleDrop, false);
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    
                    // å¤„ç†æ‹–æ”¾çš„æ–‡ä»¶å¤¹
                    handleFolderUpload(files);
                }
            }
        }
        
        // åœ¨é¡µé¢å®Œå…¨åŠ è½½ååˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDragAndDrop);
        } else {
            // å¦‚æœæ–‡æ¡£å·²ç»åŠ è½½å®Œæˆï¼Œåˆ™ç›´æ¥åˆå§‹åŒ–
            initDragAndDrop();
        }
        
        // å½“åˆ‡æ¢åˆ°æ–‡ä»¶ç®¡ç†æ ‡ç­¾æ—¶åŠ è½½æ–‡ä»¶åˆ—è¡¨
        function loadFileManager() {
            // ä½¿ç”¨inputä½œä¸ºé»˜è®¤ç›®å½•
            loadFileList('input');
        }

        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            const tabs = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.add('hidden');
                tabs[i].classList.remove('active');
            }
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            const navTabs = document.getElementsByClassName('nav-tab');
            for (let i = 0; i < navTabs.length; i++) {
                navTabs[i].classList.remove('bg-blue-600', 'text-white');
                navTabs[i].classList.add('text-gray-200');
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName).classList.remove('hidden');
            document.getElementById(tabName).classList.add('active');
            
            // æ›´æ–°é€‰ä¸­çš„å¯¼èˆªæ ‡ç­¾æ ·å¼
            event.currentTarget.classList.remove('text-gray-200');
            event.currentTarget.classList.add('bg-blue-600', 'text-white');
            
            // å¦‚æœåˆ‡æ¢åˆ°å·¥å…·æ ‡ç­¾ï¼Œåˆ™åŠ è½½å·¥å…·åˆ—è¡¨
            if (tabName === 'tools') {
                loadToolsList();
            }
            // å¦‚æœåˆ‡æ¢åˆ°æ–‡ä»¶ç®¡ç†æ ‡ç­¾ï¼Œåˆ™åŠ è½½æ–‡ä»¶åˆ—è¡¨
            else if (tabName === 'filemanager') {
                loadFileManager();
            }
        }
        
        function loadToolsList() {
            fetch('/api/tools')
                .then(response => response.json())
                .then(tools => {
                    const toolsListDiv = document.getElementById('tools-list');
                    toolsListDiv.innerHTML = '';
                    
                    // ä¸åŒå·¥å…·çš„å›¾æ ‡æ˜ å°„
                    const toolIcons = {
                        'generate_indextts2_audio': 'fas fa-microphone-alt',
                        'generate_subtitles_from_indextts2': 'fas fa-closed-captioning',
                        'file_split_novel_into_chapters': 'fas fa-file-alt',
                        'generate_image_from_text': 'fas fa-paint-brush',
                        'generate_image_from_image': 'fas fa-image',
                        'generate_images_from_chapter': 'fas fa-images',
                        'generate_images_from_chapter_with_ai_prompt': 'fas fa-robot',
                        'default': 'fas fa-cog'
                    };
                    
                    tools.forEach(function(tool) {
                        const toolCard = document.createElement('div');
                        toolCard.className = 'glass-effect rounded-2xl p-6 border border-white border-opacity-20 card-hover future-glow';
                        
                        // è·å–å¯¹åº”å·¥å…·çš„å›¾æ ‡
                        const iconClass = toolIcons[tool.name] || toolIcons['default'];
                        
                        // ä¸ºgenerate_indextts2_audioå·¥å…·æ·»åŠ ç‰¹æ®Šå¤„ç†
                        let cardContent = '';
                        if (tool.name === 'generate_indextts2_audio') {
                            // ä¸ºéŸ³é¢‘ç”Ÿæˆå·¥å…·æ·»åŠ è¡¨å•
                            cardContent = `
                                <div class="tool-header text-center">
                                    <div class="flex flex-col items-center">
                                        <div class="w-16 h-16 bg-blue-500 bg-opacity-20 rounded-full flex items-center justify-center mb-4">
                                            <i class="${iconClass} text-blue-300 text-2xl"></i>
                                        </div>
                                        <h3 class="text-xl font-bold text-white mb-2">${tool.name}</h3>
                                        <p class="text-lg text-gray-300 mb-4">${tool.description}</p>
                                        <button onclick="toggleAudioForm('${tool.name}')" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white py-3 px-4 rounded-xl transition-all duration-200 future-glow text-lg">
                                            æ‰§è¡Œå·¥å…·
                                        </button>
                                    </div>
                                </div>
                                <div id="form_${tool.name}" class="audio-tool-form mt-6 p-6 glass-effect rounded-xl border border-white border-opacity-20 hidden">
                                    <div class="form-group mb-6">
                                        <label class="block text-lg font-bold text-gray-300 mb-3">è¾“å…¥æ–‡æœ¬:</label>
                                        <textarea id="textInput_${tool.name}" placeholder="è¯·è¾“å…¥è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡æœ¬" rows="3" class="w-full px-4 py-3 bg-black bg-opacity-30 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"></textarea>
                                    </div>
                                    <div class="form-group mb-6">
                                        <label class="block text-lg font-bold text-gray-300 mb-3">è¾“å‡ºç›®å½•:</label>
                                        <input type="text" id="outputDir_${tool.name}" value="./output/" placeholder="è¯·è¾“å…¥è¾“å‡ºç›®å½•" class="w-full px-4 py-3 bg-black bg-opacity-30 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg">
                                    </div>
                                    <div class="flex flex-wrap gap-4">
                                        <button onclick="executeAudioTool('${tool.name}')" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-lg transition-all duration-200 future-glow text-lg">
                                            ç”ŸæˆéŸ³é¢‘
                                        </button>
                                        <button onclick="hideAudioForm('${tool.name}')" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-lg transition-all duration-200 future-glow text-lg">
                                            å–æ¶ˆ
                                        </button>
                                    </div>
                                </div>
                            `;
                        } else if (tool.name === 'generate_images_from_chapter_with_ai_prompt') {
                            // ä¸ºå›¾åƒç”Ÿæˆå·¥å…·æ·»åŠ è¡¨å•
                            cardContent = `
                                <div class="tool-header text-center">
                                    <div class="flex flex-col items-center">
                                        <div class="w-16 h-16 bg-blue-500 bg-opacity-20 rounded-full flex items-center justify-center mb-4">
                                            <i class="${iconClass} text-blue-300 text-2xl"></i>
                                        </div>
                                        <h3 class="text-xl font-bold text-white mb-2 break-words max-w-full">${tool.name}</h3>
                                        <p class="text-lg text-gray-300 mb-4">${tool.description}</p>
                                        <button onclick="toggleImageForm('${tool.name}')" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white py-3 px-4 rounded-xl transition-all duration-200 future-glow text-lg">
                                            æ‰§è¡Œå·¥å…·
                                        </button>
                                    </div>
                                </div>
                                <div id="form_${tool.name}" class="audio-tool-form mt-6 p-6 glass-effect rounded-xl border border-white border-opacity-20 hidden">
                                    <div class="form-group mb-6">
                                        <label class="block text-lg font-bold text-gray-300 mb-3">ç« èŠ‚æ–‡æœ¬:</label>
                                        <textarea id="chapterText_${tool.name}" placeholder="è¯·è¾“å…¥è¦ç”Ÿæˆå›¾åƒçš„ç« èŠ‚æ–‡æœ¬" rows="4" class="w-full px-4 py-3 bg-black bg-opacity-30 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"></textarea>
                                    </div>
                                    <div class="form-group mb-6">
                                        <label class="block text-lg font-bold text-gray-300 mb-3">è¾“å‡ºç›®å½•:</label>
                                        <input type="text" id="outputDir_${tool.name}" value="./output/images_" placeholder="è¯·è¾“å…¥è¾“å‡ºç›®å½•" class="w-full px-4 py-3 bg-black bg-opacity-30 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg">
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                        <div class="form-group">
                                            <label class="block text-lg font-bold text-gray-300 mb-3">å›¾åƒå®½åº¦:</label>
                                            <input type="number" id="imageWidth_${tool.name}" value="512" min="256" max="2048" class="w-full px-4 py-3 bg-black bg-opacity-30 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg">
                                        </div>
                                        <div class="form-group">
                                            <label class="block text-lg font-bold text-gray-300 mb-3">å›¾åƒé«˜åº¦:</label>
                                            <input type="number" id="imageHeight_${tool.name}" value="896" min="256" max="2048" class="w-full px-4 py-3 bg-black bg-opacity-30 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg">
                                        </div>
                                    </div>
                                    <div class="flex flex-wrap gap-4">
                                        <button onclick="executeImageTool('${tool.name}')" class="bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 px-6 py-3 rounded-lg transition-all duration-200 future-glow text-lg">
                                            ç”Ÿæˆå›¾åƒ
                                        </button>
                                        <button onclick="hideImageForm('${tool.name}')" class="bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 px-6 py-3 rounded-lg transition-all duration-200 future-glow text-lg">
                                            å–æ¶ˆ
                                        </button>
                                    </div>
                                </div>
                            `;
                        } else {
                            // å…¶ä»–å·¥å…·ä½¿ç”¨æ™®é€šæŒ‰é’®
                            cardContent = `
                                <div class="tool-header text-center">
                                    <div class="flex flex-col items-center">
                                        <div class="w-20 h-20 bg-blue-500 bg-opacity-20 rounded-full flex items-center justify-center mb-5">
                                            <i class="${iconClass} text-blue-300 text-3xl"></i>
                                        </div>
                                        <h3 class="text-xl font-bold text-white mb-3">${tool.name}</h3>
                                        <p class="text-lg text-gray-300 mb-6">${tool.description}</p>
                                        <button onclick="executeTool('${tool.name}')" class="w-full bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-gray-800 py-3 px-4 rounded-xl transition-all duration-200 future-glow text-lg">
                                            æ‰§è¡Œå·¥å…·
                                        </button>
                                    </div>
                                </div>
                            `;
                        }
                        
                        toolCard.innerHTML = cardContent;
                        toolsListDiv.appendChild(toolCard);
                    });
                })
                .catch(error => {
                    console.error('Error loading tools:', error);
                    // æ·»åŠ é”™è¯¯æç¤º
                    const toolsListDiv = document.getElementById('tools-list');
                    toolsListDiv.innerHTML = '<div class="col-span-full text-red-400 p-8 text-center text-xl"><i class="fas fa-exclamation-triangle mr-3"></i>åŠ è½½å·¥å…·åˆ—è¡¨å¤±è´¥: ' + error.message + '</div>';
                });
        }
        
        // æ˜¾ç¤ºéŸ³é¢‘ç”Ÿæˆè¡¨å•
        function toggleAudioForm(toolName) {
            const form = document.getElementById('form_' + toolName);
            if (form) {
                form.classList.toggle('hidden');
            }
        }
        
        // éšè—éŸ³é¢‘ç”Ÿæˆè¡¨å•
        function hideAudioForm(toolName) {
            const form = document.getElementById('form_' + toolName);
            if (form) {
                form.classList.add('hidden');
            }
        }

        // æ˜¾ç¤ºå›¾åƒç”Ÿæˆè¡¨å•
        function toggleImageForm(toolName) {
            const form = document.getElementById('form_' + toolName);
            if (form) {
                form.classList.toggle('hidden');
            }
        }

        // éšè—å›¾åƒç”Ÿæˆè¡¨å•
        function hideImageForm(toolName) {
            const form = document.getElementById('form_' + toolName);
            if (form) {
                form.classList.add('hidden');
            }
        }

        // æ‰§è¡ŒéŸ³é¢‘ç”Ÿæˆå·¥å…·
        function executeAudioTool(toolName) {
            const textInput = document.getElementById('textInput_' + toolName).value;
            const outputDir = document.getElementById('outputDir_' + toolName).value;
            
            if (!textInput || textInput.trim() === '') {
                alert('è¯·è¾“å…¥è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡æœ¬');
                return;
            }
            
            // ç”Ÿæˆè¾“å‡ºæ–‡ä»¶è·¯å¾„
            const timestamp = new Date().getTime();
            const outputFile = outputDir + '/audio_' + timestamp + '.wav';
            
            const params = {
                toolName: toolName,
                text: textInput,
                output_file: outputFile
            };
            
            fetch('/api/execute', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(params)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Audio tool execution initiated:', data);
                // éšè—è¡¨å•
                hideAudioForm(toolName);
            })
            .catch(error => {
                console.error('Error executing audio tool:', error);
            });
        }

        // æ‰§è¡Œå›¾åƒç”Ÿæˆå·¥å…·
        function executeImageTool(toolName) {
            const chapterText = document.getElementById('chapterText_' + toolName).value;
            const outputDir = document.getElementById('outputDir_' + toolName).value;
            const imageWidth = parseInt(document.getElementById('imageWidth_' + toolName).value);
            const imageHeight = parseInt(document.getElementById('imageHeight_' + toolName).value);
            
            if (!chapterText || chapterText.trim() === '') {
                alert('è¯·è¾“å…¥è¦ç”Ÿæˆå›¾åƒçš„ç« èŠ‚æ–‡æœ¬');
                return;
            }
            
            if (!outputDir || outputDir.trim() === '') {
                alert('è¯·è¾“å…¥è¾“å‡ºç›®å½•');
                return;
            }
            
            // ç”Ÿæˆè¾“å‡ºç›®å½•è·¯å¾„
            const timestamp = new Date().getTime();
            const outputDirectory = outputDir + timestamp;
            
            const params = {
                toolName: toolName,
                chapter_text: chapterText,
                output_dir: outputDirectory,
                width: imageWidth,
                height: imageHeight
            };
            
            fetch('/api/execute', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(params)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Image tool execution initiated:', data);
                // éšè—è¡¨å•
                hideImageForm(toolName);
            })
            .catch(error => {
                console.error('Error executing image tool:', error);
            });
        }
        
        function executeTool(toolName) {
            fetch('/api/execute', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({toolName: toolName})
            })
            .then(response => response.json())
            .then(data => {
                console.log('Tool execution initiated:', data);
            })
            .catch(error => {
                console.error('Error executing tool:', error);
            });
        }
        
        function oneClickFilm() {
            fetch('/api/one-click-film', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                console.log('ä¸€é”®å‡ºç‰‡å·¥ä½œæµå·²å¯åŠ¨:', data);
            })
            .catch(error => {
                console.error('ä¸€é”®å‡ºç‰‡æ‰§è¡Œé”™è¯¯:', error);
            });
        }
        
        function stopExecution() {
            fetch('/api/stop', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                console.log('Execution stopped:', data);
            })
            .catch(error => {
                console.error('Error stopping execution:', error);
            });
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('uploadArea').classList.add('border-blue-400', 'bg-blue-400', 'bg-opacity-10');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('uploadArea').classList.remove('border-blue-400', 'bg-blue-400', 'bg-opacity-10');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                // ç®€å•æ˜¾ç¤ºä¸Šä¼ çŠ¶æ€
                document.getElementById('uploadStatus').innerText = 'å·²æ”¾ç½®æ–‡ä»¶: ' + files.length + ' ä¸ªæ–‡ä»¶';
            }
        }
        
        function processFolder() {
            fetch('/api/process-folder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                console.log('Folder processing initiated:', data);
            })
            .catch(error => {
                console.error('Error processing folder:', error);
            });
        }
        
        // åˆå§‹åŒ– - åŠ è½½å·¥å…·åˆ—è¡¨
        window.onload = function() {
            // åœ¨åˆå§‹çŠ¶æ€ä¸‹åŠ è½½å·¥å…·åˆ—è¡¨
            if (document.querySelector('.nav-tab.active').textContent.includes('MCP å·¥å…·')) {
                loadToolsList();
            }
        };
    </script>
</body>
</html>